function [desired_state] = diamond_new(t, qn)
% DIAMOND trajectory generator for a diamond



% =================== Your code goes here ===================
% You have to set the pos, vel, acc, yaw and yawdot variables


% a =  [      0     ,    0  ,       0;
%     0.2500  ,  1.4100  ,  1.4100;
%     0.5000  ,       0   , 2.8200;
%     0.7500  , -1.4100   , 1.4100;
%     1.0000  ,       0  ,       0];

    tmax = 8.5;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55    
if t>=0 && t<=tmax/4
        
  % fitting a min-jerk trajectory for first segment
    q0 = 0;
    v0 = 0;
    ac0 = 0;
    q1 = tmax/4;
    v1 = 0;
    ac1 = 0;
    t0 = 0;
    tf = tmax/4;
 
     d =[q0,v0,ac0,q1,v1,ac1,t0,tf];
     a = min_jerk(d) ;
% q0,v0,ac0,q1,v1,ac1,t0,tf
% qt  = a(1) + a(2)*t + a(3)*t^2 + a(4)*t^3 + a(5)*t^4 + a(6)*t^5;
 a1 = a(1);
 a2 = a(2);
 a3 = a(3);
 a4 = a(4);
 a5 = a(5);
 a6 = a(6);
 qt = (a1 + a2*t + a3*t^2+  a4*t^3 + a5*t^4 + a6*t^5);%*w;

    x = 0.25*qt/(tmax/4);
    y = 1.414*qt/(tmax/4);
    z = 1.414*qt/(tmax/4);
    
    dx = (10*a6*t^4)/17 + (8*a5*t^3)/17 + (6*a4*t^2)/17 + (4*a3*t)/17 + (2*a2)/17;
    dy = (1414*a6*t^4)/425 + (5656*a5*t^3)/2125 + (4242*a4*t^2)/2125 + (2828*a3*t)/2125 + (1414*a2)/2125;
    dz = (1414*a6*t^4)/425 + (5656*a5*t^3)/2125 + (4242*a4*t^2)/2125 + (2828*a3*t)/2125 + (1414*a2)/2125;
    
    d2x =(40*a6*t^3)/17 + (24*a5*t^2)/17 + (12*a4*t)/17 + (4*a3)/17;
    d2y = (5656*a6*t^3)/425 + (16968*a5*t^2)/2125 + (8484*a4*t)/2125 + (2828*a3)/2125;
    d2z = (5656*a6*t^3)/425 + (16968*a5*t^2)/2125 + (8484*a4*t)/2125 + (2828*a3)/2125;
    
    
    pos = [x ; y; z];
    vel = [dx; dy ; dz];
    acc = [ d2x; d2y; d2z];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    elseif t>tmax/4 && t<=2*tmax/4
    q0 = tmax/4;
    v0 = 0;
    ac0 = 0;
    q1 = 2*tmax/4;
    v1 = 0;
    ac1 = 0;
    t0 = tmax/4;
    tf = 2*tmax/4;
 
     d =[q0,v0,ac0,q1,v1,ac1,t0,tf];
     a = min_jerk(d) ;
% q0,v0,ac0,q1,v1,ac1,t0,tf
% qt  = a(1) + a(2)*t + a(3)*t^2 + a(4)*t^3 + a(5)*t^4 + a(6)*t^5;
 a1 = a(1);
 a2 = a(2);
 a3 = a(3);
 a4 = a(4);
 a5 = a(5);
 a6 = a(6);
 qt = (a1 + a2*t + a3*t^2+  a4*t^3 + a5*t^4 + a6*t^5);%*w;

x = qt/tmax;
y = 1.414 - 1.414*(qt - tmax/4)/(tmax/4);
z = 1.414 + 1.414*(qt - tmax/4)/(tmax/4);
    
  dx = (10*a6*t^4)/17 + (8*a5*t^3)/17 + (6*a4*t^2)/17 + (4*a3*t)/17 + (2*a2)/17;
  dy = - (1414*a6*t^4)/425 - (5656*a5*t^3)/2125 - (4242*a4*t^2)/2125 - (2828*a3*t)/2125 - (1414*a2)/2125;
  dz =   (1414*a6*t^4)/425 + (5656*a5*t^3)/2125 + (4242*a4*t^2)/2125 + (2828*a3*t)/2125 + (1414*a2)/2125;
 
  d2x = (40*a6*t^3)/17 + (24*a5*t^2)/17 + (12*a4*t)/17 + (4*a3)/17;
  d2y = - (5656*a6*t^3)/425 - (16968*a5*t^2)/2125 - (8484*a4*t)/2125 - (2828*a3)/2125;
  d2z = (5656*a6*t^3)/425 + (16968*a5*t^2)/2125 + (8484*a4*t)/2125 + (2828*a3)/2125;
 
 
    pos = [x ; y; z];
    vel = [dx; dy ; dz];
    acc = [ d2x; d2y; d2z];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    elseif t>2*tmax/4 && t<=3*tmax/4
        
    q0 = 2*tmax/4;
    v0 = 0;
    ac0 = 0;
    q1 = 3*tmax/4;
    v1 = 0;
    ac1 = 0;
    t0 = 2*tmax/4;
    tf = 3*tmax/4;
 
     d =[q0,v0,ac0,q1,v1,ac1,t0,tf];
     a = min_jerk(d) ;
% q0,v0,ac0,q1,v1,ac1,t0,tf
% qt  = a(1) + a(2)*t + a(3)*t^2 + a(4)*t^3 + a(5)*t^4 + a(6)*t^5;
 a1 = a(1);
 a2 = a(2);
 a3 = a(3);
 a4 = a(4);
 a5 = a(5);
 a6 = a(6);
 qt = (a1 + a2*t + a3*t^2+  a4*t^3 + a5*t^4 + a6*t^5);%*w;

     x = qt/tmax;
     y = -1.414*(qt - 2*tmax/4)/(tmax/4);
     z = ( 2*1.414) - (1.414*(qt - 2*tmax/4) /(tmax/4));
     
     dx = (10*a6*t^4)/17 + (8*a5*t^3)/17 + (6*a4*t^2)/17 + (4*a3*t)/17 + (2*a2)/17;
     dy = - (1414*a6*t^4)/425 - (5656*a5*t^3)/2125 - (4242*a4*t^2)/2125 - (2828*a3*t)/2125 - (1414*a2)/2125;
     dz = - (1414*a6*t^4)/425 - (5656*a5*t^3)/2125 - (4242*a4*t^2)/2125 - (2828*a3*t)/2125 - (1414*a2)/2125;

     d2x = (40*a6*t^3)/17 + (24*a5*t^2)/17 + (12*a4*t)/17 + (4*a3)/17;
     d2y = - (5656*a6*t^3)/425 - (16968*a5*t^2)/2125 - (8484*a4*t)/2125 - (2828*a3)/2125;
     d2z = - (5656*a6*t^3)/425 - (16968*a5*t^2)/2125 - (8484*a4*t)/2125 - (2828*a3)/2125;
 
    pos = [x ; y; z];
    vel = [dx; dy ; dz];
    acc = [ d2x; d2y; d2z];

 
    
    elseif t>3*tmax/4 && t<=tmax 
    
    q0 = 3*tmax/4;
    v0 = 0;
    ac0 = 0;
    q1 = tmax;
    v1 = 0;
    ac1 = 0;
    t0 = 3*tmax/4;
    tf = tmax;
 
     d =[q0,v0,ac0,q1,v1,ac1,t0,tf];
     a = min_jerk(d) ;
% q0,v0,ac0,q1,v1,ac1,t0,tf
% qt  = a(1) + a(2)*t + a(3)*t^2 + a(4)*t^3 + a(5)*t^4 + a(6)*t^5;
 a1 = a(1);
 a2 = a(2);
 a3 = a(3);
 a4 = a(4);
 a5 = a(5);
 a6 = a(6);
 qt = (a1 + a2*t + a3*t^2+  a4*t^3 + a5*t^4 + a6*t^5);%*w;
 
    x = qt/tmax;
    y = -1.414 +  1.414*(qt - 3*tmax/4)/(tmax/4);
    z = 1.414 - 1.414*(qt - 3*tmax/4)/(tmax/4); 
    
    dx =(10*a6*t^4)/17 + (8*a5*t^3)/17 + (6*a4*t^2)/17 + (4*a3*t)/17 + (2*a2)/17;
    dy =(1414*a6*t^4)/425 + (5656*a5*t^3)/2125 + (4242*a4*t^2)/2125 + (2828*a3*t)/2125 + (1414*a2)/2125;
    dz = - (1414*a6*t^4)/425 - (5656*a5*t^3)/2125 - (4242*a4*t^2)/2125 - (2828*a3*t)/2125 - (1414*a2)/2125;
    
    d2x =(40*a6*t^3)/17 + (24*a5*t^2)/17 + (12*a4*t)/17 + (4*a3)/17;
    d2y =(5656*a6*t^3)/425 + (16968*a5*t^2)/2125 + (8484*a4*t)/2125 + (2828*a3)/2125;
    d2z = - (1414*a6*t^4)/425 - (5656*a5*t^3)/2125 - (4242*a4*t^2)/2125 - (2828*a3*t)/2125 - (1414*a2)/2125;
 
    pos = [x ; y; z];
    vel = [dx; dy ; dz];
    acc = [ d2x; d2y; d2z];
    
    elseif t> tmax
        x = 1;
        y = 0;
        z = 0;
        pos = [x,y,z];
        vel =[0,0,0];
        acc = [0 ; 0; 0];
end
    

yaw = 0;
yawdot = 0;


% =================== Your code ends here ===================

desired_state.pos = pos(:);
desired_state.vel = vel(:);
desired_state.acc = acc(:);
desired_state.yaw = yaw;
desired_state.yawdot = yawdot;

end